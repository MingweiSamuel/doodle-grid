{"mappings":"A,C,KEAO,IAAI,EAAW,EAAE,CACb,EAAU,GAInB,EDJe,CAAC,aAAa,iDAAiD,8CAA8C,8CAA8C,uBAAuB,uDAAuD,uDAAuD,sCAAsC,sCAAsC,qCAAqC,CCKha,EDJc,4BGFT,IAAM,EAAgB,SAAS,QAAQ,CAAC,UAAU,CAAC,gBAAkB,eAAiB,IAChF,EAAa,AAAI,OAAO,CAAC,EAAE,EAAc,OAAO,CAAC,EDGxD,EAAmB,CACrB,KACG,AAAA,EAAS,GAAG,CAAC,AAAA,GAAQ,EAAK,OAAO,CAAC,MAAO,IAC/C,CAGD,eAAe,IACX,IAAM,EAAQ,MAAM,OAAO,IAAI,CAAC,EAChC,OAAM,EAAM,MAAM,CAAC,EACvB,CAEA,eAAe,IACX,IAAM,EAAO,MAAM,OAAO,IAAI,EAC9B,OAAM,QAAQ,GAAG,CACb,EAAK,GAAG,CAAC,AAAA,IACD,IAAQ,GACR,QAAQ,GAAG,CAAC,yBAA0B,GACtC,OAAO,MAAM,CAAC,IAEd,QAAQ,GAAG,CAAC,wBAAyB,EAE7C,GAER,CAEA,eAAe,EAAQ,CAAgB,EACnC,IAAI,EAAM,EAAQ,GAAG,CACjB,AAAA,EAAW,IAAI,CAAC,IAChB,CAAA,EAAM,CAAY,EAEtB,IAAM,EAAgB,MAAM,OAAO,KAAK,CAAC,EAAK,CAAE,aAAc,CAAA,CAAK,SAGnE,CADA,QAAQ,GAAG,CAAC,aAAc,EAAQ,GAAG,CAAE,MAAO,MAAQ,GAClD,MAAQ,GACD,EAEA,MAAM,MAAM,EAE3B,CAlCA,QAAQ,GAAG,CAAC,kBAAmB,CAAE,iBAAA,EAAkB,QAAA,CAAQ,GAoC3D,iBAAiB,UAAW,AAAA,IACxB,QAAQ,GAAG,CAAC,WACZ,EAAE,SAAS,CAAC,IAChB,GAEA,iBAAiB,WAAY,AAAA,IACzB,QAAQ,GAAG,CAAC,YACZ,EAAE,SAAS,CAAC,IAChB,GAEA,iBAAiB,QAAS,AAAC,GAAkB,EAAE,WAAW,CAAC,EAAQ,EAAE,OAAO,IAI5E,iBAAiB,eAAgB,AAAA,IAE7B,QAAQ,GAAG,CAAC,gBAAiB,AADf,EACqB,GAAG,EACtC,AAFc,EAER,SAAS,CAAC,IACpB,E,C","sources":["<anon>","node_modules/@parcel/service-worker/runtime-16d806397586e927.js","node_modules/@parcel/service-worker/service-worker.js","src/service-worker.ts","src/path.ts"],"sourcesContent":["(() => {\nvar $634fa512bc07a92d$exports = {};\nlet $2039b88b1be162b9$export$e538f94cc8cf4db8 = [];\nlet $2039b88b1be162b9$export$83d89fbfd8236492 = \"\";\nfunction $2039b88b1be162b9$export$c208e1278d7beb2(m, v) {\n    $2039b88b1be162b9$export$e538f94cc8cf4db8 = m;\n    $2039b88b1be162b9$export$83d89fbfd8236492 = v;\n}\n\n\nconst $634fa512bc07a92d$var$manifest = [\n    \"index.html\",\n    \"apple-touch-icon.3d779e23.png\",\n    \"favicon-32x32.52fc8606.png\",\n    \"favicon-16x16.6f6ea6b1.png\",\n    \"manifest.webmanifest\",\n    \"android-chrome-192x192.00f95b7f.png\",\n    \"android-chrome-512x512.ad51f5e3.png\",\n    \"index.aeee5389.css\",\n    \"index.f66464dd.css\",\n    \"index.b487acda.js\"\n];\nconst $634fa512bc07a92d$var$version = \"2e7bf3bf\";\n(0, $2039b88b1be162b9$export$c208e1278d7beb2)($634fa512bc07a92d$var$manifest, $634fa512bc07a92d$var$version);\n\nvar $0c81e46209371114$exports = {};\n\nconst $5e3f03d36081311d$export$62889a617136c146 = location.pathname.startsWith(\"/doodlegrid/\") ? \"/doodlegrid/\" : \"/\";\nconst $5e3f03d36081311d$export$163aca7d519d55e9 = new RegExp(`${$5e3f03d36081311d$export$62889a617136c146}(\\\\d+)$`);\n\n\nconst $0c81e46209371114$var$manifestRelative = [\n    (0, $5e3f03d36081311d$export$62889a617136c146),\n    ...(0, $2039b88b1be162b9$export$e538f94cc8cf4db8).map((file)=>file.replace(/^\\//, (0, $5e3f03d36081311d$export$62889a617136c146)))\n];\nconsole.log(\"service-worker:\", {\n    manifestRelative: $0c81e46209371114$var$manifestRelative,\n    version: $2039b88b1be162b9$export$83d89fbfd8236492\n});\nasync function $0c81e46209371114$var$refreshCache() {\n    const cache = await caches.open((0, $2039b88b1be162b9$export$83d89fbfd8236492));\n    await cache.addAll($0c81e46209371114$var$manifestRelative);\n}\nasync function $0c81e46209371114$var$cleanCache() {\n    const keys = await caches.keys();\n    await Promise.all(keys.map((key)=>{\n        if (key !== (0, $2039b88b1be162b9$export$83d89fbfd8236492)) {\n            console.log(\"activate: clearing key\", key);\n            caches.delete(key);\n        } else console.log(\"activate: keeping key\", key);\n    }));\n}\nasync function $0c81e46209371114$var$onFetch(request) {\n    let url = request.url;\n    if ((0, $5e3f03d36081311d$export$163aca7d519d55e9).test(url)) url = (0, $5e3f03d36081311d$export$62889a617136c146);\n    const cacheResponse = await caches.match(url, {\n        ignoreSearch: true\n    });\n    console.log(\"fetch: url\", request.url, \"hit\", null != cacheResponse);\n    if (null != cacheResponse) return cacheResponse;\n    else return await fetch(request);\n}\naddEventListener(\"install\", (e)=>{\n    console.log(\"install\");\n    e.waitUntil($0c81e46209371114$var$refreshCache());\n});\naddEventListener(\"activate\", (e)=>{\n    console.log(\"activate\");\n    e.waitUntil($0c81e46209371114$var$cleanCache());\n});\naddEventListener(\"fetch\", (e)=>e.respondWith($0c81e46209371114$var$onFetch(e.request)));\naddEventListener(\"periodicsync\", (e)=>{\n    const event = e;\n    console.log(\"periodicsync:\", event.tag);\n    event.waitUntil($0c81e46209371114$var$refreshCache());\n});\n\n})();\n//# sourceMappingURL=service-worker.js.map\n","import {_register} from '@parcel/service-worker';\nconst manifest = [\"index.html\",\"apple-touch-icon.3d779e23.png\",\"favicon-32x32.52fc8606.png\",\"favicon-16x16.6f6ea6b1.png\",\"manifest.webmanifest\",\"android-chrome-192x192.00f95b7f.png\",\"android-chrome-512x512.ad51f5e3.png\",\"index.aeee5389.css\",\"index.f66464dd.css\",\"index.b487acda.js\"];\nconst version = \"2e7bf3bf\";\n_register(manifest, version);\n","export let manifest = [];\nexport let version = '';\n\n// Called by the runtime.\nexport function _register(m, v) {\n  manifest = m;\n  version = v;\n}\n","import { manifest, version } from '@parcel/service-worker';\n\nimport { BASE_PATHNAME, EDIT_REGEX } from './path';\n\nconst manifestRelative = [\n    BASE_PATHNAME,\n    ...manifest.map(file => file.replace(/^\\//, BASE_PATHNAME)),\n]\nconsole.log('service-worker:', { manifestRelative, version });\n\nasync function refreshCache() {\n    const cache = await caches.open(version);\n    await cache.addAll(manifestRelative);\n}\n\nasync function cleanCache() {\n    const keys = await caches.keys();\n    await Promise.all(\n        keys.map(key => {\n            if (key !== version) {\n                console.log('activate: clearing key', key);\n                caches.delete(key);\n            } else {\n                console.log('activate: keeping key', key);\n            }\n        })\n    );\n}\n\nasync function onFetch(request: Request): Promise<Response> {\n    let url = request.url;\n    if (EDIT_REGEX.test(url)) {\n        url = BASE_PATHNAME;\n    }\n    const cacheResponse = await caches.match(url, { ignoreSearch: true });\n\n    console.log('fetch: url', request.url, 'hit', null != cacheResponse);\n    if (null != cacheResponse) {\n        return cacheResponse;\n    } else {\n        return await fetch(request);\n    }\n}\n\naddEventListener('install', e => {\n    console.log('install');\n    e.waitUntil(refreshCache());\n});\n\naddEventListener('activate', e => {\n    console.log('activate');\n    e.waitUntil(cleanCache());\n});\n\naddEventListener('fetch', (e: FetchEvent) => e.respondWith(onFetch(e.request)));\n\n/// https://developer.mozilla.org/en-US/docs/Web/API/PeriodicSyncEvent\ntype PeriodicSyncEvent = { tag: string } & ExtendableEvent;\naddEventListener('periodicsync', e => {\n    const event = e as PeriodicSyncEvent;\n    console.log('periodicsync:', event.tag);\n    event.waitUntil(refreshCache());\n});\n","export const BASE_PATHNAME = location.pathname.startsWith('/doodlegrid/') ? '/doodlegrid/' : '/';\nexport const EDIT_REGEX = new RegExp(`${BASE_PATHNAME}(\\\\d+)$`);\n"],"names":["$2039b88b1be162b9$export$e538f94cc8cf4db8","$2039b88b1be162b9$export$83d89fbfd8236492","$5e3f03d36081311d$export$62889a617136c146","location","pathname","startsWith","$5e3f03d36081311d$export$163aca7d519d55e9","RegExp","$0c81e46209371114$var$manifestRelative","map","file","replace","$0c81e46209371114$var$refreshCache","cache","caches","open","addAll","$0c81e46209371114$var$cleanCache","keys","Promise","all","key","console","log","delete","$0c81e46209371114$var$onFetch","request","url","test","cacheResponse","match","ignoreSearch","fetch","manifestRelative","version","addEventListener","e","waitUntil","respondWith","event","tag"],"version":3,"file":"service-worker.js.map"}